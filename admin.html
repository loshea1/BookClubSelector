<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bookies Admin</title>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 2em; background: #f4f4f4; }
    h1 { color: #2c5f2d; }
    ul { list-style: none; padding: 0; }
    li { padding: 5px; }
    input, button { padding: 8px; margin: 10px; }
    button { background-color: #2c5f2d; color: white; border: none; cursor: pointer; }
    .delete-btn { color: red; cursor: pointer; margin-left: 10px; }
    nav a { margin: 0 10px; text-decoration: none; color: #2c5f2d; font-weight: bold; }
    nav a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <nav style="margin-bottom: 2em;">
    <a href="index.html">🏠 Submit</a> |
    <a href="history.html">📚 History</a> |
    <a href="availability.html">📆 Availability</a> |
    <a href="admin.html">🛠️ Admin</a>
  </nav>

  <h1>Bookies Admin Panel</h1>

  <h2>Members</h2>
  <ul id="memberList"></ul>
  let members = JSON.parse(localStorage.getItem('members')) || ['leah','jojo','sarah','erika','katie daniels','katie rohrer','kelly','allison'];
  <input type="text" id="newMember" placeholder="Add member">
  <button onclick="addMember()">Add</button>

  <h2>Submission Deadlines</h2>
  <div>
    <label>Book Submission Deadline:</label>
    <input type="datetime-local" id="bookDeadline">
    <button onclick="updateDeadline('bookSubmissionDeadline')">Save</button>
  </div>
  <div>
    <label>Availability Submission Deadline:</label>
    <input type="datetime-local" id="availabilityDeadline">
    <button onclick="updateDeadline('availabilityDeadline')">Save</button>
  </div>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const firebaseConfig = {
        apiKey: "AIzaSyDlQQOiioFMEsvvJfduLXlDqMN1T5s8cWo",
        authDomain: "bookies-availability.firebaseapp.com",
        databaseURL: "https://bookies-availability-default-rtdb.firebaseio.com",
        projectId: "bookies-availability",
        storageBucket: "bookies-availability.appspot.com",
        messagingSenderId: "429713911832",
        appId: "1:429713911832:web:0da21ca51099bfd8e7536d"
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      const memberList = document.getElementById('memberList');
      const bookDeadlineInput = document.getElementById('bookDeadline');
      const availabilityDeadlineInput = document.getElementById('availabilityDeadline');

      function loadMembers() {
        db.ref('members').once('value').then(snapshot => {
          const members = snapshot.val() || [];
          memberList.innerHTML = '';
          members.forEach((name, idx) => {
            const li = document.createElement('li');
            li.textContent = name;
            const x = document.createElement('span');
            x.textContent = '✖';
            x.className = 'delete-btn';
            x.onclick = () => deleteMember(idx);
            li.appendChild(x);
            memberList.appendChild(li);
          });
        });
      }

      function loadDeadlines() {
        db.ref('settings').once('value').then(snapshot => {
          const settings = snapshot.val() || {};
          if (settings.bookSubmissionDeadline)
            bookDeadlineInput.value = formatForInput(settings.bookSubmissionDeadline);
          if (settings.availabilityDeadline)
            availabilityDeadlineInput.value = formatForInput(settings.availabilityDeadline);
        });
      }

      function formatForInput(isoString) {
        const dt = new Date(isoString);
        const local = new Date(dt.getTime() - dt.getTimezoneOffset() * 60000);
        return local.toISOString().slice(0,16);
      }

      window.addMember = () => {
        const name = document.getElementById('newMember').value.trim();
        if (!name) return;
        db.ref('members').once('value').then(snapshot => {
          const members = snapshot.val() || [];
          if (!members.includes(name)) {
            members.push(name);
            db.ref('members').set(members).then(loadMembers);
            document.getElementById('newMember').value = '';
          }
        });
      };

      window.deleteMember = (index) => {
        db.ref('members').once('value').then(snapshot => {
          const members = snapshot.val() || [];
          members.splice(index, 1);
          db.ref('members').set(members).then(loadMembers);
        });
      };

      window.updateDeadline = (key) => {
        const input = key === 'bookSubmissionDeadline' ? bookDeadlineInput : availabilityDeadlineInput;
        const date = input.value;
        if (!date) return alert('Pick a date/time first');
        db.ref('settings/' + key).set(new Date(date).toISOString()).then(() => {
          alert('Deadline updated!');
        });
      };

      loadMembers();
      loadDeadlines();
    });
  </script>
</body>
</html>
